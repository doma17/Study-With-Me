# CORS - Cross Origin Resources Sharing

CORS는 웹 브라우저에서 기본적으로 적용되는 동일 출처 정책(Same-Origin Policy)의 예외를 허용하기 위한 HTTP 표준이빈다. 
즉 웹 페이지가 본래의 (도메인, 프로토콜, 포트)와 다른 출처의 서버 리소스에 접근할 수 있도록 서버가 안전하게 허용 여부를 명시해 주는 매커니즘입니다.

![CORS](https://i.namu.wiki/i/EzlnkRXd47ckGTkCMNcvt3kc-1Zs0ep4XyNiVwHGJSB1ECapixTMsYN4DtQRGWSXFj9e37VwDv5zuocgC2KFVg.webp)

## 배경

CORS가 사용되게 된 이유는 웹 보안 강화 때문입니다. 서로 다른 출처에서 리소스를 요청을 제한하기 위해서 입니다.

하지만, 실제 웹 서비스에서는 외부 API 연동 혹은 프론트와 백엔드 분리 개발 등 다양한 이류로 출처 간 리소스 공유가 필요합니다.

## 동작원리

- 브라우저가 다른 출처의 서버에 리소스를 요청할 때, 요청 헤더에 Origin이라는 필드를 포함하여 현재 출처를 명시합니다.
- 서버는 요청을 받고 허용할 경우, 응답 헤더에 Access-Control-Allow-Origin과 같은 CORS 관련 정보를 담아 반환합니다.
- 브라우저는 서버 응답의 헤더와 자신의 Origin을 비교하여 허용된 출처라면 리소스를 사용할 수 있습니다.

![플로우](https://mdn.github.io/shared-assets/images/diagrams/http/cors/simple-request.svg)

만약에 특정 리소스만 허용하기 위해서는 아래와 같이 헤더가 출력될 것 입니다.

```HTTP
Access-Control-Allow-Origin: https://foo.example
```

## 주요 CORS HTTP 헤더

- Access-Control-Allow-Origin: 어느 출처에서 접근이 허용되는지 명시합니다.
- Access-Control-Allow-Methods: 허용할 HTTP 메서드(GET, POST 등)를 지정합니다.
- Access-Control-Allow-Headers: 허용할 요청 헤더를 지정합니다.
- Access-Control-Allow-Credentials: 쿠키 등 인증 정보 허용 여부를 명시합니다.

## Preflight(사전 요청) 개념

- 단순 요청이 아닌, 인증 정보나 커스텀 헤더 등 특정 조건이 포함된 요청은 먼저 OPTIONS 메서드를 사용해 서버에 사전 요청을 보내 '이런 요청을 해도 되는지' 허락을 구합니다.
- 서버가 허용하면 실제 요청이 진행되고, 허용하지 않으면 브라우저는 요청을 차단합니다.

![프리플라이트](https://mdn.github.io/shared-assets/images/diagrams/http/cors/preflight-correct.svg)

## Reference

https://developer.mozilla.org/ko/docs/Web/HTTP/Guides/CORS