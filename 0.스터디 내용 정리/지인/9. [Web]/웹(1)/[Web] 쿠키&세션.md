# 쿠키 & 세션

웹 환경에서는 반복적으로 사용되는 데이터나 정보를 종류와 특성에 맞게 저장하고 재활용하기 위해 여러 방식을 사용합니다.

그 중 HTTP 프로토콜의 특성이자 약점을 보완하기 위해 가장 대표적으로 쿠키와 세션이 사용됩니다.

- Connectionless
  HTTP에서 클라이언트가 서버에 요청(request)을 보내면, 서버는 해당 요청에 대응하는 응답(response)을 돌려주고 곧바로 연결을 종료합니다.
  이처럼 각 통신마다 별도의 접속을 맺고 끊기 때문에, 연결이 지속적으로 유지되지 않는 특징을 갖습니다.
  HTTP/1.1에서는 **`keep-alive`** 옵션을 기본값으로 적용하여 여러 요청에서 커넥션을 재활용하지만, 커넥션이 언제든 끊길 수 있는 구조라는 점에서는 비연결성이 기본 개념입니다.
  HTTP가 TCP 위에서 동작하기 때문에, 네트워크 자체는 "연결지향"이지만 HTTP 프로토콜 수준에서는 연결을 짧게 사용했다가 바로 닫으면서 서버의 자원을 효율적으로 관리할 수 있습니다.
- Stateless
  HTTP는 통신이 끝나면 상태 정보를 서버에 저장하지 않습니다.
  각 요청은 독립적으로 처리되며, 서버는 앞선 요청의 맥락이나 사용자의 상태를 알지 못합니다. 그래서 사용자가 로그인을 하고 페이지를 이동해도 매번 인증 정보를 함께 실어서 요청해야만 "동일 사용자"임을 인식할 수 있습니다.
  이런 구조는 서버 확장성과 유지 관리에 유리하지만, 사용자의 상태 유지를 원하는 서비스(예: 로그인, 장바구니 등)에서는 불편함이 발생합니다.

<br/>

이러한 HTTP의 두 특징을 보완하기 위해 쿠키와 세션이 등장했습니다.

예를 들어, 쇼핑몰에서 로그인을 한 뒤 쿠키나 세션을 이용하지 않는다면, 사용자는 페이지를 바꿀 때마다 매번 로그인을 반복해야 합니다.

반면, 쿠키 또는 세션 방식을 사용하면 로그인 상태가 유지되어 사용자의 인증이 끊기지 않고 서비스 경험이 원활해집니다.

<br/>

## 쿠키

쿠키는 크롬이나 사파리 같은 클라이언트(브라우저) 로컬에 저장되는 작은 텍스트 조각입니다.

사용자는 브라우저의 설정 화면이나 개발자 도구에서 쿠키를 확인하고 수정, 삭제할 수 있습니다.

다만 쿠키는 당사자뿐만 아니라 제 3자가 조회하는 것도 가능하기 때문에 개인 정보를 담은 내용이나 보안상 민감한 정보를 저장하는 데에는 적합하지 않습니다.

따라서 혹여 남에게 탈취되거나 사용자에 의해 조작되어도 크게 문제되지 않을 정보를 브라우저에 저장함으로써 웹사이트 이용을 편리하게 해 주는 것이 쿠키입니다.

### 쿠키의 구성 요소

- **이름**: 각각의 쿠키를 식별하는 데 사용되는 고유한 이름
- **값**: 쿠키 이름과 1:1로 대응되는 데이터 값
- **유효시간**: 쿠키가 브라우저에 남아있을 수 있는 만료 시각(기간)
- **도메인**: 어떤 도메인에서 쿠키를 사용할 수 있는지 지정
- **경로**: 어떤 요청 경로에서 쿠키가 전송될지 지정

### 쿠키의 동작 방식

1. 사용자가 웹 페이지를 요청하면 서버에서 쿠키를 새로 생성합니다.
2. 서버는 응답 시 HTTP 헤더에 쿠키 정보를 포함시켜 클라이언트(브라우저)로 전달합니다.
3. 브라우저는 만료 시간이 남아 있는 쿠키를 로컬에 저장합니다. 브라우저를 종료하더라도 만료기간이 남았다면 쿠키는 보관됩니다.
4. 사용자가 동일한 도메인과 경로로 다시 요청을 보낼 때, 해당 쿠키도 HTTP 헤더에 포함되어 서버로 전송됩니다.
5. 서버는 수신한 쿠키를 읽어 사용자 상태를 파악하거나 필요시 쿠키 정보를 갱신해서 다시 클라이언트에 응답합니다.

<br/>

## 세션

세션은 사용자가 크롬이나 사파리 같은 브라우저를 통해 웹사이트에 접근하면, 서버 측에서 개별 사용자를 구별하기 위해 생성되는 임시 저장 공간입니다.

쿠키와 달리 주요 정보(예: 인증 정보, 장바구니 내용)는 서버에 저장되고, 클라이언트에는 단지 세션 ID만 전달되어 브라우저 쿠키 형태로 보관됩니다.

사용자는 브라우저 설정이나 개발자 도구에서 세션 쿠키를 확인하고 삭제할 수 있으며, 서버가 종료되거나 세션 만료 시간이 도달하면 해당 세션도 자동으로 소멸합니다.

### 세션의 구성 요소

- 이름: 사용자를 식별하는 세션의 고유 ID(주로 무작위로 생성된 문자열)
- 값: 서버에 저장된 실제 사용자 정보(로그인 상태, 장바구니 데이터 등)
- 유효시간: 세션이 서버에서 유지되는 기간(일정 시간 경과 또는 로그아웃 시 만료)
- 도메인: 세션이 유효한 서비스 도메인
- 경로: 세션 ID가 전송될 요청 경로

### 세션의 동작 방식

- 사용자가 웹사이트에 최초로 접속해 요청을 보냅니다.
- 서버는 사용자마다 고유한 세션 ID를 생성해, 세션 저장소에 사용자 정보를 보관합니다.
- 서버는 응답 시 세션 ID를 담은 쿠키를 클라이언트에 전송합니다.
- 사용자가 브라우저를 닫지 않았고 세션이 만료되지 않은 경우, 이후의 모든 요청에는 브라우저가 세션 ID를 쿠키에 담아 자동 전송합니다.
- 서버는 받은 세션 ID로 해당 사용자의 세션 상태를 찾고, 필요한 데이터를 활용하거나 업데이트합니다.
- 세션 유효시간이 경과하면 서버에서 자동 삭제되거나, 사용자가 로그아웃 시 폐기됩니다.

세션은 서버에서 상태를 안전하게 관리할 수 있다는 점에서 개인정보나 인증 등 민감한 정보를 다루기에 적합하며, 주로 로그인이나 장바구니처럼 브라우저 여러 경로에서 동일한 사용자를 추적해야 하는 기능 구현에 활용됩니다.

<br/>
<br/>

> 참고
>
> - https://jibinary.tistory.com/270
> - https://hongong.hanbit.co.kr/%EC%99%84%EB%B2%BD-%EC%A0%95%EB%A6%AC-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%ED%86%A0%ED%81%B0-%EC%BA%90%EC%8B%9C-%EA%B7%B8%EB%A6%AC%EA%B3%A0-cdn/
> - https://interconnection.tistory.com/74
