# 프로시저 (Procedure) 정리

## 프로시저란?

컴퓨터 프로그래밍에서 특정 작업을 수행하기 위해 일련의 명령어들을 모아놓은 것을 말합니다. 이러한 명령어 집합은 하나의 단위로서 작동하며, 반복적으로 수행되어야 하는 작업들을 효율적으로 처리할 수 있게 해줍니다.

### 예시 상황

다음과 같은 상황이 주어졌을 때 프로시저를 사용하면 더 효율적으로 처리할 수 있습니다.

**상황:** `SELECT` 문을 한번 실행한 이후 그 결과에 따라 `INSERT` 또는 `UPDATE` 문을 실행할지 결정하는 코드를 구현해야 합니다.

자바와 같은 애플리케이션 언어에서는 `SELECT` 문을 실행하고 결과를 DataSet에 담아 `if` 문으로 분기 처리를 해야 합니다. 하지만 프로시저를 이용하면 이러한 과정이 간소화됩니다. 하나의 프로시저 안에서 `SELECT` 문을 실행하고 결과를 변수에 담아 비교할 수 있으므로, 애플리케이션으로 결과를 가져오는 과정(DataSet에 담는 등)이 필요 없어집니다.


```sql
-- 프로시저 선언
CREATE PROCEDURE ProcessData
AS
BEGIN
    DECLARE @result INT;

    -- SELECT 문 실행하여 결과 변수에 저장
    SELECT @result = SomeColumn
    FROM SomeTable
    WHERE SomeCondition;

    -- 결과에 따라 INSERT 또는 UPDATE 문 실행
    IF @result IS NULL
    BEGIN
        -- 결과가 없으면 INSERT 문 실행
        INSERT INTO AnotherTable (Column1, Column2)
        VALUES (Value1, Value2);
    END
    ELSE
    BEGIN
        -- 결과가 있으면 UPDATE 문 실행
        UPDATE AnotherTable
        SET Column1 = NewValue1, Column2 = NewValue2
        WHERE SomeCondition;
    END
END
```

## 프로시저의 특징

* 프로시저를 하나의 메서드(API)처럼 만들어 호출하면 내부의 동작을 일괄적으로 처리할 수 있습니다.
* 하나의 요청으로 여러 SQL 문을 실행시킬 수 있기 때문에 네트워크 부하를 줄일 수 있습니다.

## 프로시저의 반환값

프로시저는 일반적으로 입력값을 받아들여 처리하고, 결과를 반환할 수 있습니다. 전통적인 의미의 프로시저는 반환 값이 없는 서브루틴을 지칭하는 데 사용되는 경우가 많았지만, 현대의 데이터베이스 관리 시스템에서는 결과를 반환할 수도 있습니다.

프로그래밍 언어에 따라서 반환값을 가지는 프로시저는 종종 \*\*함수(Function)\*\*라고 불리기도 합니다. 즉, 기본적으로 프로시저는 함수처럼 명시적인 반환값을 가질 수 없지만, Oracle 같은 DBMS에서는 `OUT` 파라미터를 사용하여 결과를 반환하는 것처럼 구현할 수 있습니다.

## 프로시저와 함수의 차이

프로시저와 함수의 가장 큰 차이점은 **반환 값의 유무**입니다.

* **함수 (Function)**: 입력 값을 받아 연산을 수행한 후, **결과 값을 반드시 반환**합니다. 반환된 값은 외부에서 활용될 수 있습니다.
* **프로시저 (Procedure)**: 함수와 비슷하지만 **반환 값이 없습니다**. 특정 데이터를 화면에 출력하거나 파일에 저장할 수는 있지만, 호출한 지점으로 결과 값을 직접 반환하지는 않습니다.

또 다른 차이점은 함수는 **표현식(expression)으로 사용될 수 있지만, 프로시저는 아니라는 점**입니다.

```javascript
// 함수는 변수에 할당하는 등 표현식으로 사용 가능
const getRectArea = function (width, height) {
  return width * height;
};

let area = getRectArea(10, 20); // 함수의 반환값을 변수에 저장
```

## 프로시저 사용법 (MySQL 기준)

#### 1\. 프로시저 생성 / 수정

```sql
DELIMITER $$
CREATE OR REPLACE PROCEDURE 프로시저명 (
    IN 파라미터명 VARCHAR(50)
)
BEGIN
    -- SELECT, INSERT, UPDATE, DELETE 등 SQL 문 작성
    SELECT * FROM a_table WHERE a_column = 파라미터명;
END$$
DELIMITER ;
```

#### 2\. 프로시저 삭제

```sql
DROP PROCEDURE IF EXISTS 프로시저명;
```

#### 3\. 프로시저 호출

```sql
CALL 프로시저명('파라미터1', '파라미터2', ...);
```